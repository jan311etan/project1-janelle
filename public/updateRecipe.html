<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Manager - Update Recipe</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
        }
        .header {
            background-color: black;
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }
        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
            padding: 20px;
        }
        .form-box {
            background-color: white;
            border-radius: 10px;
            padding: 40px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
        }
        .form-group label {
            font-weight: bold;
        }
        #recipeDisplay {
            text-align: center;
            margin-bottom: 20px;
        }
        #recipeDisplay img {
            max-width: 200px;
            border-radius: 10px;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <!-- Header Section -->
    <div class="header">Recipe Manager - Update Recipe</div>

    <!-- Main Content Section with Form for Updating Recipe -->
    <div class="container">
        <div class="form-box">
            <button class="btn btn-secondary mb-4" onclick="history.back()">‚Üê Back</button>
            <h5 class="text-center mb-4">Update Recipe</h5>

            <!-- Recipe Display Section -->
            <div id="recipeDisplay">
                <p><strong>Recipe ID:</strong> <span id="displayRecipeId"></span></p>
                <p><strong>Recipe Name:</strong> <span id="displayRecipeName"></span></p>
                <img id="displayRecipeImage" alt="Recipe Image" style="display: none;">
            </div>

            <form id="updateRecipeForm" onsubmit="updateRecipe(); return false;">
                <div class="form-group">
                    <label for="recipeId">Select Recipe ID</label>
                    <select class="form-control" id="recipeId" onchange="loadRecipe(this.value)">
                        <option selected disabled>Select a Recipe ID</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="name">Recipe Name</label>
                    <input type="text" class="form-control" id="name" placeholder="Enter Recipe Name">
                </div>
                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea class="form-control" id="description" rows="2" placeholder="Enter Description"></textarea>
                </div>
                <div class="form-group">
                    <label for="ingredients">Ingredients</label>
                    <textarea class="form-control" id="ingredients" rows="2" placeholder="Enter ingredients, separated by commas"></textarea>
                    <small class="form-text text-muted">Separate each ingredient by a comma.</small>
                </div>
                <div class="form-group">
                    <label for="steps">Steps</label>
                    <textarea class="form-control" id="steps" rows="4" placeholder="Enter Steps"></textarea>
                </div>
                <div class="form-group">
                    <label for="image">Image URL</label>
                    <input type="text" class="form-control" id="image" placeholder="Enter Image URL" oninput="displayImage()">
                    <img id="recipeImage" alt="Recipe Image" class="img-fluid mt-2" style="display: none; border-radius: 10px;">
                </div>
                <button type="submit" class="btn btn-primary btn-block">Update Recipe</button>
                <p class="text-success mt-3" id="message"></p>
            </form>
        </div>
    </div>

    <!-- JavaScript and Bootstrap Dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        // Function to fetch and display recipes in dropdown
        async function fetchRecipeData() {
            try {
                const response = await fetch('utils/recipe.json'); // Corrected path
                if (response.ok) {
                    const recipes = await response.json();
                    populateRecipeDropdown(recipes);
                } else {
                    console.error("Failed to load recipes, status:", response.status);
                    alert("Failed to load recipes.");
                }
            } catch (error) {
                console.error("Error fetching recipes:", error);
                alert("An error occurred while loading recipes.");
            }
        }

        // Function to populate dropdown
        function populateRecipeDropdown(recipes) {
            const dropdown = document.getElementById("recipeId");
            recipes.forEach(recipe => {
                const option = document.createElement("option");
                option.value = recipe.id;
                option.textContent = recipe.id;
                dropdown.appendChild(option);
            });
        }

        // Load recipe data on dropdown change
        async function loadRecipe(recipeId) {
            try {
                const response = await fetch('utils/recipe.json');
                if (response.ok) {
                    const recipes = await response.json();
                    const recipe = recipes.find(r => r.id === recipeId);
                    if (recipe) {
                        displayRecipeDetails(recipe);
                    } else {
                        alert("Recipe not found!");
                    }
                }
            } catch (error) {
                console.error("Error loading recipe:", error);
            }
        }

        // Display selected recipe details in form fields
        function displayRecipeDetails(recipe) {
            document.getElementById("displayRecipeId").textContent = recipe.id;
            document.getElementById("displayRecipeName").textContent = recipe.recipeName;
            document.getElementById("name").value = recipe.recipeName;
            document.getElementById("description").value = recipe.description;
            document.getElementById("ingredients").value = recipe.ingredients.join(', ');
            document.getElementById("steps").value = recipe.steps;
            document.getElementById("image").value = recipe.imageLink;
            displayImage();
        }

        function displayImage() {
            const imageUrl = document.getElementById("image").value;
            const recipeImage = document.getElementById("recipeImage");
            if (imageUrl) {
                recipeImage.src = imageUrl;
                recipeImage.style.display = "block";
            } else {
                recipeImage.style.display = "none";
            }
        }

        async function updateRecipe() {
            const recipeId = document.getElementById("recipeId").value;
            const updatedRecipe = {
                recipeName: document.getElementById("name").value,
                description: document.getElementById("description").value,
                ingredients: document.getElementById("ingredients").value.split(','),
                steps: document.getElementById("steps").value,
                imageLink: document.getElementById("image").value
            };
            try {
                const response = await fetch(`http://localhost:5050/recipes/${recipeId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedRecipe)
                });
                const result = await response.json();
                alert(result.message);
            } catch (error) {
                console.error("Error updating recipe:", error);
                alert("Failed to update recipe.");
            }
        }

        document.addEventListener("DOMContentLoaded", fetchRecipeData);
    </script>
</body>
</html>
